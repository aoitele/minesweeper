<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
 
    <style>
      #app{
          position:fixed;
          top:30%;
          left:30%;
          transform: transrate(-50%, -50%);
      };  
      
      .row{
        width: 30px;
        height: 30px;
        background-color: aqua;
      }

      .block{
          float:left;
          width: 20px;
          height: 20px;
          border: 1px solid #333;
          background-color: #a0522d;
      };
      </style>
 </head>

<body>
<div id="app"></div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
const user= localStorage.getItem("user");
    if(user == null){
      console.log("ユーザー登録を行なってください");
      // モーダルの実装
      // $("body").append(`
      //   <div id="modal-overlay"></div>
      //   `
      // );
      // $("#modal-overlay").fadeIn("slow");
      $('#app').append(`
        <p>ユーザー登録を行なってください</p> 
         <div id="modal-content">
            <form id="username">
              <input id="name" type="text" name="name" placeholder="Enter your name">
              <input id=send type="button" name="send" value="登録">
            </form>
          </div>
      `
      );
      $('#send').on("click",function(){
        var name = $('#name').val();
        localStorage.setItem("user", name);
        console.log(name+'を登録しました');
        $('#name').val("");
        location.reload();
      })
    };
    
const render = (board) =>{
    // DOMを破棄して再構築
    $('#app').empty();
    let html ="";
      board.forEach(row => {
          html += `<div class="row">`
              row.forEach(column =>{
                  html += `<div class="block">`
                  html += `</div>`
              }),
          html += `</div>`
      });
    $('#app').append(html);
    // console.log(html)
};

// setInterval(() => {
  // 0.5秒ごとにサーバーにポーリング
  $.getJSON('/board', render);
// },500);

function open(e){
  console.log("開きました");

  // var rowindex = $(e.currentTarget).index(items);
  // console.log(rowindex);
  // var navItems = document.querySelectorAll(".row");
  //   for (i = 0; i < navItems.length; i++) {
  //       // navItems[i].addEventListener("click", navButtonClick.bind(null, i));
  //       console.log(i);
  //   }


}

$(document).on("click", ".block",function(){
  // xとyを算出する
  addEventListener('click', open, false); //開きます
    // DOMから要素を取得する(HTMLコレクション形式)
    let row = document.getElementsByClassName('row');
    let block = document.getElementsByClassName('block');

    // 配列に変換する
    rows = Array.from(update_board);
    console.log(rows);

    // 要素へのアクセスを定義
   
    // console.log(x);
    // y = x.div.block;

    // クリックしたrowのインデックスを取得する
    for(i=0; i<rows.length; i++){
        rows[i].onclick = (function(x){
          return function(){console.log("x:"+x);};
        })(i);
      }
    // クリックしたblockのインデックスを取得する
    // for(k=0; k<rows.length; i++){
    //     rows[k].onclick = (function(y){
    //       return function(){console.log("y:"+y);};
    //     })(k);
    //   };    
        
        // for(k=0; k<rows.length; k++){
        // rows[i].onclick = (function(x){
        //   return function(){console.log(x);};
        // })(i);
      // }

    // console.log("ひらきます");
  });

 

    // var search_x = rows.indexOf(target);
    // var search_y = rows.indexOf(search_x.block);
    // console.log(search_x);
    // x = $('.row').index(row);
    // y = $('.block').index(row);
    // console.log(x+"/"+y);

    // xとyに代入


  // $.getJSON('/board', {
  // hoge: x,
  // fuga: y,
  // user: user
  // }, render);


</script>
</body>
</html>


