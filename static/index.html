<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
 
    <style>
      #app{
          position:fixed;
          top:30%;
          left:30%;
          transform: transrate(-50%, -50%);
      };  
      
      .row{
        width: 30px;
        height: 30px;
        background-color: aqua;
      }

      .block{
          float:left;
          width: 20px;
          height: 20px;
          border: 1px solid #333;
          background-color: #a0522d;
      };
      </style>
 </head>

<body>
<div id="app"></div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>

var row;
var column;
const user= localStorage.getItem("user");
    if(user == null){
      // モーダルの実装
      // $("body").append(`
      //   <div id="modal-overlay"></div>
      //   `
      // );
      // $("#modal-overlay").fadeIn("slow");
      $('#app').append(`
        <p>ユーザー登録を行なってください</p> 
         <div id="modal-content">
            <form id="username">
              <input id="name" type="text" name="name" placeholder="Enter your name">
              <input id=send type="button" name="send" value="登録">
            </form>
          </div>
      `
      );
      $('#send').on("click",function(){
        var name = $('#name').val();
        localStorage.setItem("user", name);
        console.log(name+'を登録しました');
        $('#name').val("");
        location.reload();
      })
    };
    
const render = (board) =>{
    // DOMを破棄して再構築
    $('#app').empty();
    let html ="";
      board.forEach(row => {
          html += `<div class="row">`
              row.forEach(block =>{
                  html += `<div class="block">`
                  html += `</div>`
              }),
          html += `</div>`
      });
    $('#app').append(html);
    // console.log(html)
};

// setInterval(() => {
  // 0.5秒ごとにサーバーにポーリング
  $.getJSON('/board', render);
// },500);

async function getPoint(){
    // クリックしたrowのインデックスを取得する   
    $(document).on("click", ".row", function(){
        row = $('.row').index(this);
        console.log(row+"行");
        return row
    });
    // クリックしたblockのインデックスを取得する   
    $(document).on("click", ".block", function(){
        y = $('.block').index(this);
        column = y/10; //列は10で割った余りで算出
        column = Math.round((column - parseInt(column)) * 10); 
        console.log(column+"列");
        return column
      });
};

getPoint()

function record(row, column){
  console.log(row);
  console.log(column);
};

  // xとyに代入
  $.getJSON('/board', {
  x: row,
  y: column,
  user: user
  }, render);

</script>
</body>
</html>


