<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
 
    <style>
      #app{
          position:fixed;
          top:30%;
          left:30%;
          transform: transrate(-50%, -50%);
      };  
      
      .row{
        width: 30px;
        height: 30px;
        background-color: aqua;
      }

      .block{
          float:left;
          width: 20px;
          height: 20px;
          border: 1px solid #333;
          background-color: #ddd;
      };
      </style>
 </head>

<body>
<div id="app"></div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
const usercheck= localStorage.getItem("user");
    if(usercheck == null){
      console.log("ユーザー登録を行なってください");
      // モーダルの実装
      // $("body").append(`
      //   <div id="modal-overlay"></div>
      //   `
      // );
      // $("#modal-overlay").fadeIn("slow");
      $('#app').append(`
        <p>ユーザー登録を行なってください</p> 
         <div id="modal-content">
            <form id="username">
              <input id="name" type="text" name="name" placeholder="Enter your name">
              <input id=send type="button" name="send" value="登録">
            </form>
          </div>
      `
      );
      $('#send').on("click",function(){
        var name = $('#name').val();
        localStorage.setItem("user", name);
        console.log(name+'を登録しました');
        $('#name').val("");
        location.reload();
      })
    }else{
      const render = (board) =>{
          // DOMを破棄して再構築
          $('#app').empty();
          let html ="";
          board.forEach(row => {
              html += `<div id="row">`
                  row.forEach(column =>{
                      html += `<div class="block">`
                      html += `</div>`
                  }),
              html += `</div>`

          });
          console.log(html);
          $('#app').append(html);
        }

        // setInterval(() => {
          // 0.5秒ごとにサーバーにポーリング
          $.getJSON('/board', render);
        // },500);
      };

$(document).on("click", ".block",function(){
  // xとyを算出する
  $.getJSON('/board', {
  x: x,
  y: y,
  user: user,
  }, render);
});

</script>
</body>
</html>


